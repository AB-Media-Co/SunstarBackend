import{j as e,aV as t,aY as a,C as l,aU as s}from"./ui-vendor-ib5n1sau.js";import{b as r,a as n,u as o,i}from"./react-vendor-TJBKpoaW.js";import{g as c}from"./index-BDVyzZVq.js";import{I as d}from"./Icons-BsxJ1ZFC.js";import{b as m}from"./query-vendor-B-W3jWpx.js";import{u as x,c as u}from"./index-Bl04lSVd.js";import{u as h}from"./useRoomsHook-Gq1ct_IO.js";import{getSingleHotelWithCode as y}from"./useHotelHook2-Dg3SXKg3.js";import{e as f,g}from"./urlHelper-B-upFRYv.js";import{s as p,a as w,b,c as j,i as v,f as N,e as k,g as C,h as D,j as M,d as I}from"./utils-iyq1-MzM.js";const S=r.memo((function({month:l,allowPrev:s,allowNext:r,onPrev:o,onNext:i,daysInWeek:c,checkIn:d,checkOut:m,hoverDate:x,onDayClick:u,onDayHover:h}){const y=n.useMemo((()=>p(w(l))),[l]),f=n.useMemo((()=>Array.from({length:42},((e,t)=>b(y,t)))),[y]),g=n.useMemo((()=>j(new Date)),[]);return e.jsxs("div",{className:"w-full lg:w-[48%] flex flex-col gap-4 relative p-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[s?e.jsx("button",{onClick:o,className:"hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white shadow-md transition hover:scale-105 "+(v(l,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-primary-green"),disabled:v(l,new Date),"aria-label":"Previous month",children:e.jsx(t,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"}),e.jsx("h2",{className:"font-bold text-xl md:text-2xl text-primary-green text-center w-full",children:N(l,"MMMM yyyy")}),r?e.jsx("button",{onClick:i,className:"hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white bg-primary-green shadow-md transition hover:scale-105","aria-label":"Next month",children:e.jsx(a,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"})]}),e.jsxs("div",{className:"px-1 md:px-4",children:[e.jsx("div",{className:"grid grid-cols-7 text-sm md:text-base text-center font-medium text-gray-500 pb-2 border-b border-gray-100",children:c.map(((t,a)=>e.jsx("div",{className:"py-2",children:t},a)))}),e.jsx("div",{className:"grid grid-cols-7 gap-y-2 sm:gap-y-3 pt-2",children:f.map(((t,a)=>{const s=N(t,"M")===N(l,"M"),r=s&&d&&k(t,d),n=s&&m&&k(t,m),o=x&&d&&!m&&s&&C(t,d)&&D(t,x),i=s&&d&&m&&C(t,d)&&D(t,m),c=D(t,g),y=k(t,new Date);return e.jsx("div",{className:`flex items-center justify-center h-10 sm:h-12 relative transition ${s?"":"opacity-0"} ${r?"bg-primary-green rounded-l-full z-10":""} ${n?"bg-primary-green rounded-r-full z-10":""} ${i||o?"bg-primary-green/20":""} ${c?"text-gray-300 cursor-not-allowed":s?"hover:bg-primary-green/10 cursor-pointer":""} ${y&&!r?"ring-2 ring-primary-green/30 ring-inset":""}`,onClick:()=>s&&!c&&u(t),onMouseEnter:()=>s&&!c&&h(t),children:s&&e.jsx("div",{className:"flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full text-sm md:text-base font-medium "+(r||n?"bg-primary-green text-white scale-110 shadow-md z-20":i||o?"text-primary-green":""),children:N(t,"d")})},a)}))})]})]})})),E=({setCheckInDate:r,setCheckOutDate:p,setOpenCalender:b,hotelCode:k})=>{const[E,O]=n.useState((()=>new Date)),P=n.useMemo((()=>M(E,1)),[E]),{closeHotelModal:H}=x(),[T,z]=n.useState(null),$=o();let W=new URLSearchParams($.search).get("hotelCode");if(!W&&$.pathname.startsWith("/hotels/")){const e=$.pathname.split("/");e.length>2&&(W=f(e[2]))}n.useEffect((()=>{!localStorage.getItem("hotelInfo")&&W&&(async()=>{var e;try{const t=await y(W);localStorage.setItem("hotelInfo",JSON.stringify(null==t?void 0:t.hotel)),z(null==(e=null==t?void 0:t.hotel)?void 0:e.authKey)}catch(t){}})()}),[W]);const[R,q]=n.useState(null),[F,K]=n.useState(null),[J,L]=n.useState(!1),[Q,U]=n.useState(null),[A,B]=n.useState(!1),G=n.useRef(null),V=i(),Y=m(),X=n.useMemo((()=>["S","M","T","W","T","F","S"]),[]);n.useMemo((()=>j(new Date)),[]);const Z=n.useMemo((()=>{try{return JSON.parse(localStorage.getItem("hotelInfo")||"null")}catch{return null}}),[]);n.useEffect((()=>{const e=localStorage.getItem("checkInDate"),t=localStorage.getItem("checkOutDate"),a=e=>e?j(new Date(e)):null,l=a(e),s=a(t),r=j(new Date);if(!l||!s||D(l,r)||!C(s,l)||!C(s,r)){q(null),K(null);try{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate")}catch{}O(w(r))}else q(l),K(s),O(w(l))}),[]),n.useEffect((()=>{A&&G.current&&c.fromTo(G.current,{opacity:0,y:-20,scale:.95},{opacity:1,y:0,scale:1,duration:.5,ease:"back.out(1.7)"})}),[A]),n.useEffect((()=>{c.fromTo(".Calender",{x:300,opacity:0},{duration:.8,x:0,opacity:1,ease:"power3.out"}),c.fromTo(".footer",{y:50,opacity:0},{duration:.8,y:0,opacity:1,ease:"power3.out",delay:.3})}),[]);const _=k??(null==Z?void 0:Z.hotelCode)??W??null,ee=(null==Z?void 0:Z.authKey)??T??null,te=n.useMemo((()=>R?N(R,"yyyy-MM-dd"):null),[R]),ae=n.useMemo((()=>F?N(F,"yyyy-MM-dd"):null),[F]),le=Boolean(_&&ee&&te&&ae),se=h(_,ee,te,ae,{enabled:le,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,keepPreviousData:!0,retry:1}),re=n.useCallback((e=>{if(!R||R&&F)q(e),K(null),B(!1);else if(D(e,R))q(e),B(!1);else{const t=I(e,R);K(e),B(t>30)}}),[R,F]),ne=n.useCallback((e=>{R&&!F&&U(e)}),[R,F]),oe=n.useCallback((()=>O((e=>M(e,-1)))),[]),ie=n.useCallback((()=>O((e=>M(e,1)))),[]),ce=n.useCallback((()=>{if(R&&F){const e=I(F,R);return 1===e?"1 Night":`${e} Nights`}return""}),[R,F]),de=n.useCallback((async()=>{if(!J){L(!0);try{if(!R||!F)return;if(C(R,F))return;const t=N(R,"yyyy-MM-dd"),a=N(F,"yyyy-MM-dd");r(t),p(a);try{localStorage.setItem("checkInDate",t),localStorage.setItem("checkOutDate",a)}catch(e){}const l=_;if(!l)return;await Y.ensureQueryData({queryKey:["rooms",l,ee,t,a],queryFn:async({signal:e})=>(await u.get("/api/ezee/syncedRooms",{params:{hotelCode:l,authCode:ee,fromDate:t,toDate:a},signal:e})).data,staleTime:3e5,gcTime:18e5}),V(g(l,null==Z?void 0:Z.name)),b(!1),H()}catch(t){}finally{L(!1)}}}),[H,J,R,F,r,p,_,ee,Y,V,b]);return e.jsxs("div",{className:"calendar-container flex flex-col justify-start md:justify-end relative",children:[e.jsxs("div",{className:"Calender flex flex-col bg-white lg:w-[95%] w-full md:p-6 lg:flex-row gap-6 shadow-lg md:rounded-t-xl overflow-y-auto max-h-[85vh]",children:[A&&e.jsx("div",{ref:G,className:"absolute z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-xl p-5 md:p-6 w-[320px] md:w-[360px] max-w-[90%]",children:e.jsxs("div",{className:"flex flex-col items-center text-start",children:[e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-primary-green/10 rounded-full flex items-center justify-center mb-3",children:e.jsx(d,{name:"calendar",className:"w-6 h-6 md:w-7 md:h-7 text-primary-green"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-primary-dark-green mb-2",children:"Planning a long stay?"}),e.jsx("p",{className:"text-gray-600 text-sm md:text-base mb-4",children:"Currently, we don't support online bookings for more than 30 nights. However, you can tell us about your plans and we'll make it happen."}),e.jsxs("div",{className:"flex justify-between w-full items-center",children:[e.jsx("button",{type:"button",className:"text-primary-yellow w-full font-bold text-left",onClick:()=>window.location.href="/booking-form",children:"Get in touch"}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 w-full text-right text-sm font-medium",onClick:()=>{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate"),q(null),K(null),B(!1)},children:"Continue selection"})]})]})}),A&&e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm z-40",onClick:()=>B(!1)}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-4 md:hidden",children:[e.jsx("button",{onClick:oe,className:"flex w-8 h-8 items-center justify-center rounded-full "+(v(E,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"text-white bg-primary-green"),disabled:v(E,new Date),"aria-label":"Previous month",children:e.jsx(t,{style:{width:12,height:12}})}),e.jsx("h2",{className:"font-bold text-lg text-primary-green",children:"Select your stay dates"}),e.jsx("button",{onClick:ie,className:"flex w-8 h-8 items-center justify-center rounded-full text-white bg-primary-green","aria-label":"Next month",children:e.jsx(a,{style:{width:12,height:12}})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-6",children:[e.jsx(S,{month:E,allowPrev:!0,allowNext:!1,onPrev:oe,onNext:ie,daysInWeek:X,checkIn:R,checkOut:F,hoverDate:Q,onDayClick:re,onDayHover:ne}),e.jsx(S,{month:P,allowPrev:!1,allowNext:!0,onPrev:oe,onNext:ie,daysInWeek:X,checkIn:R,checkOut:F,hoverDate:Q,onDayClick:re,onDayHover:ne})]})]})]}),e.jsx("button",{onClick:()=>b(!1),className:"absolute right-4 top-4 text-gray-500 hover:text-gray-700 transition-colors bg-white/80 hover:bg-white rounded-full p-1 shadow-md z-20","aria-label":"Close calendar",children:e.jsx(l,{})}),e.jsxs("div",{className:"footer fixed md:sticky bottom-0 left-0 z-40 bg-white w-full px-4 md:px-8 py-4 md:py-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center w-full md:w-auto md:max-w-[60%] bg-gray-50 px-4 py-3 md:px-6 md:py-4 rounded-xl gap-3 shadow-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(d,{name:"calendar",className:"w-5 h-5 md:w-6 md:h-6 text-primary-green mr-2"}),e.jsxs("div",{className:"flex flex-col "+(J&&!R?"text-red-500":"text-gray-700"),children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check in"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:R?N(R,"EEE, MMM d"):"Select date"})]})]}),e.jsx(s,{className:"text-primary-green mx-1 md:mx-2"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex flex-col "+(J&&!F?"text-red-500":"text-gray-700"),children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check out"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:F?N(F,"EEE, MMM d"):"Select date"})]})}),R&&F&&e.jsx("div",{className:"ml-2 flex items-center justify-center text-xs md:text-sm font-medium text-primary-green bg-primary-green/10 rounded-full px-3 py-1",children:ce()})]}),e.jsx("button",{onClick:de,disabled:!R||!F||A||J,className:"w-full md:w-auto font-bold text-white px-6 py-3 md:py-4 rounded-xl shadow-lg transition "+(!R||!F||A||J?"bg-gray-300 cursor-not-allowed":"bg-primary-dark-green hover:bg-primary-green"),children:J?"Loadingâ€¦":"Confirm Dates"})]}),se.isError&&le&&e.jsx("p",{className:"text-red-600 text-xs mt-2",children:"Could not load availability. Please try again."})]})]})};export{E as default};
