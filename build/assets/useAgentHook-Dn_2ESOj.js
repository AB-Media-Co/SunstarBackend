var e=Object.defineProperty,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,t=(a,n,o)=>n in a?e(a,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[n]=o,l=(e,l)=>{for(var r in l||(l={}))n.call(l,r)&&t(e,r,l[r]);if(a)for(var r of a(l))o.call(l,r)&&t(e,r,l[r]);return e},r=(e,a,n)=>new Promise(((o,t)=>{var l=e=>{try{s(n.next(e))}catch(a){t(a)}},r=e=>{try{s(n.throw(e))}catch(a){t(a)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(l,r);s((n=n.apply(e,a)).next())}));import{h as s,g as i,_ as u,l as d}from"./react-vendor-tq68JOgp.js";import{c as v}from"./index-BZBH8CwT.js";const c=(e={})=>s({queryKey:["agents",e],queryFn:()=>r(void 0,null,(function*(){var a;const n=yield v.get("/api/agents",{params:e});return(null==(a=null==n?void 0:n.data)?void 0:a.data)||[]})),staleTime:3e4,refetchOnWindowFocus:!1}),p=()=>i({mutationFn:e=>r(void 0,null,(function*(){const a=yield v.post("/api/agents/login",e);return l({httpStatus:a.status},a.data)})),onSuccess:e=>{u.success((null==e?void 0:e.message)||"OTP sent to your email")},onError:e=>{var a,n;u.error((null==(n=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:n.message)||"Login failed")}}),g=()=>{const e=d();return i({mutationFn:e=>r(void 0,null,(function*(){const a=yield v.post("/api/agents/verify-otp",e);return l({httpStatus:a.status},a.data)})),onSuccess:(a,n)=>{var o,t;const l=String((null==(o=null==a?void 0:a.data)?void 0:o.email)||(null==n?void 0:n.email)||"").toLowerCase();l&&localStorage.setItem("user_email",l),(null==a?void 0:a.data)&&e.setQueryData(["agent-by-email",l],a.data),e.invalidateQueries({queryKey:["agent-by-email",l]}),e.invalidateQueries({queryKey:["agents"]}),!0===(null==a?void 0:a.pendingApproval)||!1===(null==(t=null==a?void 0:a.data)?void 0:t.approved)?u.success((null==a?void 0:a.message)||"Verified. Your account is pending approval."):(null==a?void 0:a.ok)?u.success((null==a?void 0:a.message)||"Login successful"):u.error((null==a?void 0:a.message)||"Verification failed")},onError:e=>{var a,n,o;const t=null==(a=null==e?void 0:e.response)?void 0:a.status,l=null==(o=null==(n=null==e?void 0:e.response)?void 0:n.data)?void 0:o.message;403!==t?u.error(l||"Invalid or expired OTP"):u.success(l||"Verified. Your account is pending approval.")}})},m=()=>i({mutationFn:e=>r(void 0,null,(function*(){return(yield v.post("/api/agents/login",e)).data})),onSuccess:e=>{u.success((null==e?void 0:e.message)||"OTP re-sent")},onError:e=>{var a,n;u.error((null==(n=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:n.message)||"Failed to resend OTP")}}),y=()=>{const e=d();return i({mutationFn:e=>r(void 0,null,(function*(){var a;const n=yield v.post(`/api/agents/${e}/approve`);return null==(a=null==n?void 0:n.data)?void 0:a.data})),onSuccess:a=>{u.success("Agent approved"),e.invalidateQueries({queryKey:["agents"]}),(null==a?void 0:a._id)&&e.setQueryData(["agent",a._id],a),(null==a?void 0:a.email)&&e.invalidateQueries({queryKey:["agent-by-email",String(a.email).toLowerCase()]})},onError:e=>{var a,n;u.error((null==(n=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:n.message)||"Approval failed")}})},f=e=>{const a=String(e||"").toLowerCase();return s({queryKey:["agent-by-email",a],enabled:!!a,queryFn:()=>r(void 0,null,(function*(){var e;const n=yield v.get("/api/agents/by-email",{params:{email:a}});return(null==(e=null==n?void 0:n.data)?void 0:e.data)||null})),staleTime:3e4,refetchOnWindowFocus:!1,refetchInterval:e=>!(!e||!e.isVerified||e.approved)&&15e3})},b=()=>{const e=d();return i({mutationFn:e=>r(void 0,null,(function*(){return(yield v.delete(`/api/agents/${e}`)).data})),onSuccess:a=>{u.success((null==a?void 0:a.message)||"Agent deleted"),e.invalidateQueries({queryKey:["agents"]})},onError:e=>{var a,n;u.error((null==(n=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:n.message)||"Delete failed")}})};export{y as a,b,p as c,g as d,m as e,f,c as u};
