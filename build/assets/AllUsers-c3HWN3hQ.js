import{j as e}from"./ui-vendor-ib5n1sau.js";import{a as s,i as t,b as a}from"./react-vendor-TJBKpoaW.js";import{a as r,i as l,j as n,k as d,n as o}from"./index-Bl04lSVd.js";import{u as i,a as c,b as x}from"./useAgentHook-6pyUW_71.js";import"./query-vendor-B-W3jWpx.js";const p=({value:s,onChange:t})=>e.jsx("div",{className:"inline-flex rounded-lg overflow-hidden border border-gray-200",children:[{key:"all",label:"All"},{key:"agent",label:"Agents"},{key:"corporate",label:"Corporate"}].map((a=>e.jsx("button",{onClick:()=>t(a.key),className:"px-4 py-2 text-sm font-medium transition "+(s===a.key?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:a.label},a.key)))}),m=({row:s,onApprove:t,onDelete:a,approving:r,deleting:l})=>e.jsxs("tr",{className:"border-t hover:bg-[#ffff] transition duration-200",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-medium text-gray-800",children:s.name}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-600",children:s.phone}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-600",children:s.email}),e.jsx("td",{className:"px-6 py-3 text-sm capitalize text-gray-700",children:s.role}),e.jsx("td",{className:"px-6 py-3 text-sm",children:s.approved?e.jsxs("span",{className:"inline-flex items-center gap-2 text-green-700",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," Approved"]}):e.jsxs("span",{className:"inline-flex items-center gap-2 text-yellow-700",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400"})," Pending"]})}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-700",children:new Date(s.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-6 py-3 text-sm flex gap-2",children:[e.jsx("button",{onClick:()=>t(s._id),disabled:s.approved||r,className:"px-3 py-1 rounded-md text-white "+(s.approved||r?"bg-green-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"),title:s.approved?"Already approved":"Approve",children:s.approved?"Approved":r?"...":"Approve"}),e.jsx("button",{onClick:()=>a(s._id,s.name),disabled:l,className:"px-3 py-1 rounded-md text-white "+(l?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"),children:l?"Deleting...":"Delete"})]})]}),u=({defaultTab:t="all"})=>{const[a,r]=s.useState(t),l=s.useMemo((()=>"all"===a?{}:{role:a}),[a]),{data:n,isLoading:d,error:o,refetch:u}=i(l),{mutate:g,isPending:h}=c(),{mutate:b,isPending:y}=x(),j=n||[],w=e=>{g(e,{onSuccess:()=>{u()},onError:e=>{}})},N=(e,s)=>{window.confirm(`Delete ${s||"this record"}? This action cannot be undone.`)&&b(e,{onSuccess:e=>{u()},onError:e=>{}})};return e.jsxs("section",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Agents & Corporate Users"}),e.jsx(p,{value:a,onChange:r})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg shadow-md bg-white",children:d?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading..."}):o?e.jsx("div",{className:"p-8 text-center text-red-500",children:o.message||"Failed to load"}):0===j.length?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"No records found."}):e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-700",children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:j.map((s=>e.jsx(m,{row:s,onApprove:w,onDelete:N,approving:h,deleting:y},s._id)))})]})})]})},g=()=>{const{allUsers:i,isUsersLoading:c,usersError:x}=r(),p=t(),[m,g]=s.useState("users"),[h,b]=s.useState(null),[y,j]=s.useState({}),[w,N]=s.useState(null);s.useState("");const{mutate:f,isLoading:v}=l(),{mutate:C,isLoading:k}=n(),{mutate:A,isLoading:S}=d();if(c)return e.jsx("div",{className:"text-center text-xl text-gray-500",children:"Loading..."});if(x)return e.jsx("div",{className:"text-center text-red-500",children:x.message||"Error loading users"});const P=e=>{j({...y,[e.target.name]:e.target.value})},D=()=>{const e={...y,allowedCities:y.allowedCities?y.allowedCities.split(",").map((e=>e.trim())):[],allowedHotels:y.allowedHotels?y.allowedHotels.split(",").map((e=>e.trim())):[]};f({id:h,updatedData:e},{onSuccess:()=>{o.success("User updated successfully"),b(null)},onError:e=>{o.error(e.message||"Failed to update user")}})},E=e=>{g(e),b(null),N(null),j({})};return e.jsxs("div",{className:"flex flex-col gap-10 mx-auto p-6 pt-28 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-extrabold",children:"users"===m?"All Users":"Agent & Corporate Manager"}),"users"===m&&e.jsx("button",{className:"py-2 px-4 rounded-lg shadow-md transition-all duration-300 bg-blue-500 text-white hover:bg-blue-600",onClick:()=>p("/admin/create_user"),children:"Create User"})]}),e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{className:"py-2 px-4 text-sm font-medium border-b-2 transition-colors duration-200 "+("users"===m?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),onClick:()=>E("users"),children:"Users"}),e.jsx("button",{className:"py-2 px-4 text-sm font-medium border-b-2 transition-colors duration-200 "+("agents"===m?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),onClick:()=>E("agents"),children:"Agent & Corporate"})]}),"users"===m?e.jsx("div",{className:"overflow-x-auto rounded-lg shadow-md bg-white mt-6",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-700",children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Allowed Cities"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Allowed Hotels"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Created At"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:null==(H=null==i?void 0:i.data)?void 0:H.map((s=>e.jsxs(a.Fragment,{children:[e.jsx("tr",{className:"border-t hover:bg-[#ffff] transition duration-200",children:h===s._id?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("input",{name:"username",value:y.username,onChange:P,className:"border px-2 py-1 rounded-md",disabled:v})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("input",{name:"phone",value:y.phone,onChange:P,className:"border px-2 py-1 rounded-md",disabled:v})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("input",{name:"email",value:y.email,onChange:P,className:"border px-2 py-1 rounded-md",disabled:v})}),e.jsx("td",{className:"px-6 py-4 text-sm capitalize",children:e.jsxs("select",{name:"role",value:y.role,onChange:P,className:"border px-2 py-1 rounded-md",disabled:v,children:[e.jsx("option",{value:"superadmin",children:"SuperAdmin"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"contentManager",children:"Content Manager"}),e.jsx("option",{value:"cityManager",children:"City Manager"}),e.jsx("option",{value:"hotelManager",children:"Hotel Manager"}),e.jsx("option",{value:"digitalMarketer",children:"Digital Marketer"})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("input",{name:"allowedCities",value:y.allowedCities,onChange:P,className:"border px-2 py-1 rounded-md",disabled:v})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("input",{name:"allowedHotels",value:y.allowedHotels,onChange:P,className:"border px-2 py-1 rounded-md",disabled:v})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 text-sm flex gap-2",children:[e.jsx("button",{onClick:D,className:"bg-green-500 text-white px-4 py-1 rounded-md hover:bg-green-600 disabled:bg-green-400",disabled:v,children:"Save"}),e.jsx("button",{onClick:()=>b(null),className:"bg-gray-500 text-white px-4 py-1 rounded-md hover:bg-gray-600",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-6 py-4 capitalize text-sm font-medium text-gray-700",children:s.username}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.phone}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.email}),e.jsx("td",{className:"px-6 py-4 text-sm capitalize text-gray-700",children:s.role}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:s.allowedCities.join(", ")||"None"}),e.jsx("td",{className:"px-6 py-4 capitalize text-sm text-gray-700",children:s.allowedHotels.map((e=>null==e?void 0:e.name)).join(", ")||"None"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 text-sm flex gap-2",children:[e.jsx("button",{onClick:()=>N(s._id),className:"bg-yellow-500 text-white px-4 py-1 rounded-md hover:bg-yellow-600",disabled:S,children:"Change Password"}),e.jsx("button",{onClick:()=>{return e=s._id,void(window.confirm("Are you sure you want to delete this user?")&&C(e,{onSuccess:()=>{o.success("User deleted successfully")},onError:e=>{o.error(e.message||"Failed to delete user")}}));var e},className:"bg-red-500 text-white px-4 py-1 rounded-md hover:bg-red-600 disabled:bg-red-400",disabled:k,children:"Delete"})]})]})}),w===s._id&&e.jsx("tr",{className:"bg-gray-100",children:e.jsx("td",{colSpan:8,className:"px-6 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{className:"flex flex-col gap-1 relative",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Current Password"}),e.jsx("input",{type:y.showCurrent?"text":"password",placeholder:"Enter current password",value:y.currentPassword||"",onChange:e=>j({...y,currentPassword:e.target.value}),className:"border border-gray-300 px-3 py-2 pr-10 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:S}),e.jsx("button",{type:"button",className:"absolute right-3 top-9 text-gray-500 hover:text-gray-800 text-sm",onClick:()=>j({...y,showCurrent:!y.showCurrent}),children:y.showCurrent?"Hide":"Show"})]}),e.jsxs("div",{className:"flex flex-col gap-1 relative",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"New Password"}),e.jsx("input",{type:y.showNew?"text":"password",placeholder:"Enter new password",value:y.newPassword||"",onChange:e=>j({...y,newPassword:e.target.value}),className:"border border-gray-300 px-3 py-2 pr-10 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:S}),e.jsx("button",{type:"button",className:"absolute right-3 top-9 text-gray-500 hover:text-gray-800 text-sm",onClick:()=>j({...y,showNew:!y.showNew}),children:y.showNew?"Hide":"Show"})]}),e.jsxs("div",{className:"flex gap-2 mt-6 md:mt-0",children:[e.jsx("button",{onClick:()=>A({currentPassword:y.currentPassword,newPassword:y.newPassword},{onSuccess:()=>{o.success("Password changed successfully"),N(null),j({})},onError:e=>{o.error(e.message||"Failed to change password")}}),disabled:S,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:bg-green-400",children:"Save"}),e.jsx("button",{onClick:()=>{N(null),j({})},className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"Cancel"})]})]})})})]},s._id)))})]})}):e.jsx(u,{})]});var H};export{g as default};
