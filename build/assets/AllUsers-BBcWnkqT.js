var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,d=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&n(e,s,t[s]);if(a)for(var s of a(t))l.call(t,s)&&n(e,s,t[s]);return e},o=(e,a)=>t(e,s(a));import{r as i,j as c,q as x,p,v as m}from"./react-vendor-tq68JOgp.js";import{a as u,h as g,i as h,j as b}from"./index-D89k_Hd_.js";import{u as y,a as j,b as w}from"./useAgentHook-mFF-a1SR.js";import"./animation-vendor-DJegggv9.js";import"./vendor-DwD9zxym.js";import"./query-vendor-iDpT9gG9.js";import"./ui-vendor-DiJ4VKpG.js";import"./swiper-vendor-DEzR9mKq.js";import"./date-vendor-9E3U4XI3.js";const N=({value:e,onChange:t})=>c.jsx("div",{className:"inline-flex rounded-lg overflow-hidden border border-gray-200",children:[{key:"all",label:"All"},{key:"agent",label:"Agents"},{key:"corporate",label:"Corporate"}].map((s=>c.jsx("button",{onClick:()=>t(s.key),className:"px-4 py-2 text-sm font-medium transition "+(e===s.key?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:s.label},s.key)))}),f=({row:e,onApprove:t,onDelete:s,approving:a,deleting:r})=>c.jsxs("tr",{className:"border-t hover:bg-[#ffff] transition duration-200",children:[c.jsx("td",{className:"px-6 py-3 text-sm font-medium text-gray-800",children:e.name}),c.jsx("td",{className:"px-6 py-3 text-sm text-gray-600",children:e.phone}),c.jsx("td",{className:"px-6 py-3 text-sm text-gray-600",children:e.email}),c.jsx("td",{className:"px-6 py-3 text-sm capitalize text-gray-700",children:e.role}),c.jsx("td",{className:"px-6 py-3 text-sm",children:e.approved?c.jsxs("span",{className:"inline-flex items-center gap-2 text-green-700",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," Approved"]}):c.jsxs("span",{className:"inline-flex items-center gap-2 text-yellow-700",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400"})," Pending"]})}),c.jsx("td",{className:"px-6 py-3 text-sm text-gray-700",children:new Date(e.createdAt).toLocaleString()}),c.jsxs("td",{className:"px-6 py-3 text-sm flex gap-2",children:[c.jsx("button",{onClick:()=>t(e._id),disabled:e.approved||a,className:"px-3 py-1 rounded-md text-white "+(e.approved||a?"bg-green-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"),title:e.approved?"Already approved":"Approve",children:e.approved?"Approved":a?"...":"Approve"}),c.jsx("button",{onClick:()=>s(e._id,e.name),disabled:r,className:"px-3 py-1 rounded-md text-white "+(r?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"),children:r?"Deleting...":"Delete"})]})]}),v=({defaultTab:e="all"})=>{const[t,s]=i.useState(e),a=i.useMemo((()=>"all"===t?{}:{role:t}),[t]),{data:r,isLoading:l,error:n,refetch:d}=y(a),{mutate:o,isPending:x}=j(),{mutate:p,isPending:m}=w(),u=r||[],g=e=>{o(e,{onSuccess:()=>{d()},onError:e=>{}})},h=(e,t)=>{window.confirm(`Delete ${t||"this record"}? This action cannot be undone.`)&&p(e,{onSuccess:e=>{d()},onError:e=>{}})};return c.jsxs("section",{className:"flex flex-col gap-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("h2",{className:"text-2xl font-bold",children:"Agents & Corporate Users"}),c.jsx(N,{value:t,onChange:s})]}),c.jsx("div",{className:"overflow-x-auto rounded-lg shadow-md bg-white",children:l?c.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading..."}):n?c.jsx("div",{className:"p-8 text-center text-red-500",children:n.message||"Failed to load"}):0===u.length?c.jsx("div",{className:"p-8 text-center text-gray-600",children:"No records found."}):c.jsxs("table",{className:"min-w-full table-auto",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"bg-gray-50 text-gray-700",children:[c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Name"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Phone"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Email"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Role"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Status"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Created"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Actions"})]})}),c.jsx("tbody",{children:u.map((e=>c.jsx(f,{row:e,onApprove:g,onDelete:h,approving:x,deleting:m},e._id)))})]})})]})},C=()=>{const{allUsers:e,isUsersLoading:t,usersError:s}=u(),a=x(),[r,l]=i.useState("users"),[n,y]=i.useState(null),[j,w]=i.useState({}),[N,f]=i.useState(null);i.useState("");const{mutate:C,isLoading:k}=g(),{mutate:A,isLoading:P}=h(),{mutate:S,isLoading:D}=b();if(t)return c.jsx("div",{className:"text-center text-xl text-gray-500",children:"Loading..."});if(s)return c.jsx("div",{className:"text-center text-red-500",children:s.message||"Error loading users"});const E=e=>{w(o(d({},j),{[e.target.name]:e.target.value}))},H=()=>{const e=o(d({},j),{allowedCities:j.allowedCities?j.allowedCities.split(",").map((e=>e.trim())):[],allowedHotels:j.allowedHotels?j.allowedHotels.split(",").map((e=>e.trim())):[]});C({id:n,updatedData:e},{onSuccess:()=>{m.success("User updated successfully"),y(null)},onError:e=>{m.error(e.message||"Failed to update user")}})},M=e=>{l(e),y(null),f(null),w({})};return c.jsxs("div",{className:"flex flex-col gap-10 mx-auto p-6 pt-28 bg-gray-50 min-h-screen",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("h1",{className:"text-3xl font-extrabold",children:"users"===r?"All Users":"Agent & Corporate Manager"}),"users"===r&&c.jsx("button",{className:"py-2 px-4 rounded-lg shadow-md transition-all duration-300 bg-blue-500 text-white hover:bg-blue-600",onClick:()=>a("/admin/create_user"),children:"Create User"})]}),c.jsxs("div",{className:"flex border-b border-gray-200",children:[c.jsx("button",{className:"py-2 px-4 text-sm font-medium border-b-2 transition-colors duration-200 "+("users"===r?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),onClick:()=>M("users"),children:"Users"}),c.jsx("button",{className:"py-2 px-4 text-sm font-medium border-b-2 transition-colors duration-200 "+("agents"===r?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),onClick:()=>M("agents"),children:"Agent & Corporate"})]}),"users"===r?c.jsx("div",{className:"overflow-x-auto rounded-lg shadow-md bg-white mt-6",children:c.jsxs("table",{className:"min-w-full table-auto",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"bg-gray-50 text-gray-700",children:[c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Name"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Phone"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Email"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Role"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Allowed Cities"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Allowed Hotels"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Created At"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Actions"})]})}),c.jsx("tbody",{children:null==(L=null==e?void 0:e.data)?void 0:L.map((e=>c.jsxs(p.Fragment,{children:[c.jsx("tr",{className:"border-t hover:bg-[#ffff] transition duration-200",children:n===e._id?c.jsxs(c.Fragment,{children:[c.jsx("td",{className:"px-6 py-4 text-sm",children:c.jsx("input",{name:"username",value:j.username,onChange:E,className:"border px-2 py-1 rounded-md",disabled:k})}),c.jsx("td",{className:"px-6 py-4 text-sm",children:c.jsx("input",{name:"phone",value:j.phone,onChange:E,className:"border px-2 py-1 rounded-md",disabled:k})}),c.jsx("td",{className:"px-6 py-4 text-sm",children:c.jsx("input",{name:"email",value:j.email,onChange:E,className:"border px-2 py-1 rounded-md",disabled:k})}),c.jsx("td",{className:"px-6 py-4 text-sm capitalize",children:c.jsxs("select",{name:"role",value:j.role,onChange:E,className:"border px-2 py-1 rounded-md",disabled:k,children:[c.jsx("option",{value:"superadmin",children:"SuperAdmin"}),c.jsx("option",{value:"admin",children:"Admin"}),c.jsx("option",{value:"manager",children:"Manager"}),c.jsx("option",{value:"contentManager",children:"Content Manager"}),c.jsx("option",{value:"cityManager",children:"City Manager"}),c.jsx("option",{value:"hotelManager",children:"Hotel Manager"}),c.jsx("option",{value:"digitalMarketer",children:"Digital Marketer"})]})}),c.jsx("td",{className:"px-6 py-4 text-sm",children:c.jsx("input",{name:"allowedCities",value:j.allowedCities,onChange:E,className:"border px-2 py-1 rounded-md",disabled:k})}),c.jsx("td",{className:"px-6 py-4 text-sm",children:c.jsx("input",{name:"allowedHotels",value:j.allowedHotels,onChange:E,className:"border px-2 py-1 rounded-md",disabled:k})}),c.jsx("td",{className:"px-6 py-4 text-sm",children:new Date(e.createdAt).toLocaleDateString()}),c.jsxs("td",{className:"px-6 py-4 text-sm flex gap-2",children:[c.jsx("button",{onClick:H,className:"bg-green-500 text-white px-4 py-1 rounded-md hover:bg-green-600 disabled:bg-green-400",disabled:k,children:"Save"}),c.jsx("button",{onClick:()=>y(null),className:"bg-gray-500 text-white px-4 py-1 rounded-md hover:bg-gray-600",children:"Cancel"})]})]}):c.jsxs(c.Fragment,{children:[c.jsx("td",{className:"px-6 py-4 capitalize text-sm font-medium text-gray-700",children:e.username}),c.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.phone}),c.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.email}),c.jsx("td",{className:"px-6 py-4 text-sm capitalize text-gray-700",children:e.role}),c.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:e.allowedCities.join(", ")||"None"}),c.jsx("td",{className:"px-6 py-4 capitalize text-sm text-gray-700",children:e.allowedHotels.map((e=>null==e?void 0:e.name)).join(", ")||"None"}),c.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:new Date(e.createdAt).toLocaleDateString()}),c.jsxs("td",{className:"px-6 py-4 text-sm flex gap-2",children:[c.jsx("button",{onClick:()=>f(e._id),className:"bg-yellow-500 text-white px-4 py-1 rounded-md hover:bg-yellow-600",disabled:D,children:"Change Password"}),c.jsx("button",{onClick:()=>{return t=e._id,void(window.confirm("Are you sure you want to delete this user?")&&A(t,{onSuccess:()=>{m.success("User deleted successfully")},onError:e=>{m.error(e.message||"Failed to delete user")}}));var t},className:"bg-red-500 text-white px-4 py-1 rounded-md hover:bg-red-600 disabled:bg-red-400",disabled:P,children:"Delete"})]})]})}),N===e._id&&c.jsx("tr",{className:"bg-gray-100",children:c.jsx("td",{colSpan:8,className:"px-6 py-4",children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[c.jsxs("div",{className:"flex flex-col gap-1 relative",children:[c.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Current Password"}),c.jsx("input",{type:j.showCurrent?"text":"password",placeholder:"Enter current password",value:j.currentPassword||"",onChange:e=>w(o(d({},j),{currentPassword:e.target.value})),className:"border border-gray-300 px-3 py-2 pr-10 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:D}),c.jsx("button",{type:"button",className:"absolute right-3 top-9 text-gray-500 hover:text-gray-800 text-sm",onClick:()=>w(o(d({},j),{showCurrent:!j.showCurrent})),children:j.showCurrent?"Hide":"Show"})]}),c.jsxs("div",{className:"flex flex-col gap-1 relative",children:[c.jsx("label",{className:"text-sm font-medium text-gray-700",children:"New Password"}),c.jsx("input",{type:j.showNew?"text":"password",placeholder:"Enter new password",value:j.newPassword||"",onChange:e=>w(o(d({},j),{newPassword:e.target.value})),className:"border border-gray-300 px-3 py-2 pr-10 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:D}),c.jsx("button",{type:"button",className:"absolute right-3 top-9 text-gray-500 hover:text-gray-800 text-sm",onClick:()=>w(o(d({},j),{showNew:!j.showNew})),children:j.showNew?"Hide":"Show"})]}),c.jsxs("div",{className:"flex gap-2 mt-6 md:mt-0",children:[c.jsx("button",{onClick:()=>S({currentPassword:j.currentPassword,newPassword:j.newPassword},{onSuccess:()=>{m.success("Password changed successfully"),f(null),w({})},onError:e=>{m.error(e.message||"Failed to change password")}}),disabled:D,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:bg-green-400",children:"Save"}),c.jsx("button",{onClick:()=>{f(null),w({})},className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"Cancel"})]})]})})})]},e._id)))})]})}):c.jsx(v,{})]});var L};export{C as default};
