import{a as e,u as a,b as s}from"./query-vendor-B-W3jWpx.js";import{c as n,d as t}from"./index-Bl04lSVd.js";const o=(a={})=>e({queryKey:["agents",a],queryFn:async()=>{var e;const s=await n.get("/api/agents",{params:a});return(null==(e=null==s?void 0:s.data)?void 0:e.data)||[]},staleTime:3e4,refetchOnWindowFocus:!1}),i=()=>a({mutationFn:async e=>{const a=await n.post("/api/agents/login",e);return{httpStatus:a.status,...a.data}},onSuccess:e=>{t.success((null==e?void 0:e.message)||"OTP sent to your email")},onError:e=>{var a,s;t.error((null==(s=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:s.message)||"Login failed")}}),r=()=>{const e=s();return a({mutationFn:async e=>{const a=await n.post("/api/agents/verify-otp",e);return{httpStatus:a.status,...a.data}},onSuccess:(a,s)=>{var n,o;const i=String((null==(n=null==a?void 0:a.data)?void 0:n.email)||(null==s?void 0:s.email)||"").toLowerCase();i&&localStorage.setItem("user_email",i),(null==a?void 0:a.data)&&e.setQueryData(["agent-by-email",i],a.data),e.invalidateQueries({queryKey:["agent-by-email",i]}),e.invalidateQueries({queryKey:["agents"]}),!0===(null==a?void 0:a.pendingApproval)||!1===(null==(o=null==a?void 0:a.data)?void 0:o.approved)?t.success((null==a?void 0:a.message)||"Verified. Your account is pending approval."):(null==a?void 0:a.ok)?t.success((null==a?void 0:a.message)||"Login successful"):t.error((null==a?void 0:a.message)||"Verification failed")},onError:e=>{var a,s,n;const o=null==(a=null==e?void 0:e.response)?void 0:a.status,i=null==(n=null==(s=null==e?void 0:e.response)?void 0:s.data)?void 0:n.message;403!==o?t.error(i||"Invalid or expired OTP"):t.success(i||"Verified. Your account is pending approval.")}})},l=()=>a({mutationFn:async e=>(await n.post("/api/agents/login",e)).data,onSuccess:e=>{t.success((null==e?void 0:e.message)||"OTP re-sent")},onError:e=>{var a,s;t.error((null==(s=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:s.message)||"Failed to resend OTP")}}),u=()=>{const e=s();return a({mutationFn:async e=>{var a;const s=await n.post(`/api/agents/${e}/approve`);return null==(a=null==s?void 0:s.data)?void 0:a.data},onSuccess:a=>{t.success("Agent approved"),e.invalidateQueries({queryKey:["agents"]}),(null==a?void 0:a._id)&&e.setQueryData(["agent",a._id],a),(null==a?void 0:a.email)&&e.invalidateQueries({queryKey:["agent-by-email",String(a.email).toLowerCase()]})},onError:e=>{var a,s;t.error((null==(s=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:s.message)||"Approval failed")}})},d=a=>{const s=String(a||"").toLowerCase();return e({queryKey:["agent-by-email",s],enabled:!!s,queryFn:async()=>{var e;const a=await n.get("/api/agents/by-email",{params:{email:s}});return(null==(e=null==a?void 0:a.data)?void 0:e.data)||null},staleTime:3e4,refetchOnWindowFocus:!1,refetchInterval:e=>!(!e||!e.isVerified||e.approved)&&15e3})},v=()=>{const e=s();return a({mutationFn:async e=>(await n.delete(`/api/agents/${e}`)).data,onSuccess:a=>{t.success((null==a?void 0:a.message)||"Agent deleted"),e.invalidateQueries({queryKey:["agents"]})},onError:e=>{var a,s;t.error((null==(s=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:s.message)||"Delete failed")}})};export{u as a,v as b,i as c,r as d,l as e,d as f,o as u};
