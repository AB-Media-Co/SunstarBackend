import{c as ie,j as e,R as de,r as a,a7 as me,a8 as A,v as m,b as ue,u as xe,B as he,a as fe,a9 as ge,i as K,z as ye,w as te,aa as pe,I as se,C as we}from"./index-DRfTjNMi.js";import{s as Q,a as be,i as T,b as q,c as I,d as P,e as B}from"./isSameMonth-DAx5Ljl7.js";import{a as oe,A as je}from"./ArrowRightAlt-DzYtnSO3.js";const le=ie(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"})),ae=de.memo(function({month:u,allowPrev:S,allowNext:D,onPrev:y,onNext:N,daysInWeek:H,checkIn:x,checkOut:p,hoverDate:E,onDayClick:C,onDayHover:J}){const d=a.useMemo(()=>me(Q(u)),[u]),s=42,w=a.useMemo(()=>Array.from({length:s},(l,r)=>be(d,r)),[d]),o=a.useMemo(()=>A(new Date),[]);return e.jsxs("div",{className:"w-full lg:w-[48%] flex flex-col gap-4 relative p-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[S?e.jsx("button",{onClick:y,className:`hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white shadow-md transition hover:scale-105 ${T(u,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-primary-green"}`,disabled:T(u,new Date),"aria-label":"Previous month",children:e.jsx(oe,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"}),e.jsx("h2",{className:"font-bold text-xl md:text-2xl text-primary-green text-center w-full",children:m(u,"MMMM yyyy")}),D?e.jsx("button",{onClick:N,className:"hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white bg-primary-green shadow-md transition hover:scale-105","aria-label":"Next month",children:e.jsx(le,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"})]}),e.jsxs("div",{className:"px-1 md:px-4",children:[e.jsx("div",{className:"grid grid-cols-7 text-sm md:text-base text-center font-medium text-gray-500 pb-2 border-b border-gray-100",children:H.map((l,r)=>e.jsx("div",{className:"py-2",children:l},r))}),e.jsx("div",{className:"grid grid-cols-7 gap-y-2 sm:gap-y-3 pt-2",children:w.map((l,r)=>{const i=m(l,"M")===m(u,"M"),k=i&&x&&q(l,x),$=i&&p&&q(l,p),h=E&&x&&!p&&i&&I(l,x)&&P(l,E),g=i&&x&&p&&I(l,x)&&P(l,p),b=P(l,o),R=q(l,new Date);return e.jsx("div",{className:`flex items-center justify-center h-10 sm:h-12 relative transition ${i?"":"opacity-0"} ${k?"bg-primary-green rounded-l-full z-10":""} ${$?"bg-primary-green rounded-r-full z-10":""} ${g||h?"bg-primary-green/20":""} ${b?"text-gray-300 cursor-not-allowed":i?"hover:bg-primary-green/10 cursor-pointer":""} ${R&&!k?"ring-2 ring-primary-green/30 ring-inset":""}`,onClick:()=>i&&!b&&C(l),onMouseEnter:()=>i&&!b&&J(l),children:i&&e.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full text-sm md:text-base font-medium ${k||$?"bg-primary-green text-white scale-110 shadow-md z-20":g||h?"text-primary-green":""}`,children:m(l,"d")})},r)})})]})]})}),Me=({setCheckInDate:F,setCheckOutDate:u,setOpenCalender:S,hotelCode:D})=>{console.log(D?`Calendar mounted for hotelCode: ${D}`:"Calendar mounted without specific hotelCode");const[y,N]=a.useState(()=>new Date),H=a.useMemo(()=>B(y,1),[y]),{closeHotelModal:x}=ue(),[p,E]=a.useState(null),C=xe();console.log(C);let d=new URLSearchParams(C.search).get("hotelCode");if(!d&&C.pathname.startsWith("/hotels/")){const t=C.pathname.split("/");t.length>2&&(d=t[2])}a.useEffect(()=>{localStorage.getItem("hotelInfo")||!d||(console.log("Fetching hotel info for code:",d),(async()=>{var c;try{const n=await he(d);localStorage.setItem("hotelInfo",JSON.stringify(n==null?void 0:n.hotel)),E((c=n==null?void 0:n.hotel)==null?void 0:c.authKey),console.log("✅ Hotel info saved to localStorage:",n)}catch(n){console.error("❌ Failed to fetch hotel info:",n)}})())},[d]);const[s,w]=a.useState(null),[o,l]=a.useState(null),[r,i]=a.useState(!1),[k,$]=a.useState(null),[h,g]=a.useState(!1),b=a.useRef(null),R=fe(),U=ge(),G=a.useMemo(()=>["S","M","T","W","T","F","S"],[]);a.useMemo(()=>A(new Date),[]);const j=a.useMemo(()=>{try{return JSON.parse(localStorage.getItem("hotelInfo")||"null")}catch{return null}},[]);console.log("Using authKey:",j),a.useEffect(()=>{const t=localStorage.getItem("checkInDate"),c=localStorage.getItem("checkOutDate"),n=ee=>ee?A(new Date(ee)):null,f=n(t),v=n(c),L=A(new Date);if(!f||!v||P(f,L)||!I(v,f)||!I(v,L)){w(null),l(null);try{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate")}catch{}N(Q(L));return}w(f),l(v),N(Q(f))},[]),a.useEffect(()=>{h&&b.current&&K.fromTo(b.current,{opacity:0,y:-20,scale:.95},{opacity:1,y:0,scale:1,duration:.5,ease:"back.out(1.7)"})},[h]),a.useEffect(()=>{K.fromTo(".Calender",{x:300,opacity:0},{duration:.8,x:0,opacity:1,ease:"power3.out"}),K.fromTo(".footer",{y:50,opacity:0},{duration:.8,y:0,opacity:1,ease:"power3.out",delay:.3})},[]);const z=D??(j==null?void 0:j.hotelCode)??d??null,M=(j==null?void 0:j.authKey)??p??null,Y=a.useMemo(()=>s?m(s,"yyyy-MM-dd"):null,[s]),_=a.useMemo(()=>o?m(o,"yyyy-MM-dd"):null,[o]),V=!!(z&&M&&Y&&_),ne=ye(z,M,Y,_,{enabled:V,staleTime:1e3*60*5,gcTime:1e3*60*30,refetchOnWindowFocus:!1,keepPreviousData:!0,retry:1}),X=a.useCallback(t=>{if(!s||s&&o)w(t),l(null),g(!1);else if(P(t,s))w(t),g(!1);else{const c=te(t,s);l(t),g(c>30)}},[s,o]),Z=a.useCallback(t=>{s&&!o&&$(t)},[s,o]),O=a.useCallback(()=>N(t=>B(t,-1)),[]),W=a.useCallback(()=>N(t=>B(t,1)),[]),re=a.useCallback(()=>{if(s&&o){const t=te(o,s);return t===1?"1 Night":`${t} Nights`}return""},[s,o]),ce=a.useCallback(async()=>{if(r){console.log("Confirm already clicked — ignoring duplicate click");return}console.log("Confirm button clicked"),i(!0);try{if(!s||!o){console.warn("Missing check-in or check-out date");return}if(I(s,o)){console.warn("Invalid date range: check-in is after check-out");return}const t=m(s,"yyyy-MM-dd"),c=m(o,"yyyy-MM-dd");console.log("Selected Dates:",{checkIn:t,checkOut:c}),F(t),u(c);try{localStorage.setItem("checkInDate",t),localStorage.setItem("checkOutDate",c),console.log("Dates saved to localStorage")}catch(f){console.warn("Failed to save dates to localStorage:",f)}const n=z;if(!n){console.warn("No hotel code found — cannot proceed");return}console.log("Fetching rooms for hotel:",n),await U.ensureQueryData({queryKey:["rooms",n,M,t,c],queryFn:async({signal:f})=>{console.log("→ API Request: /api/ezee/syncedRooms",{hotelCode:n,authCode:M,fromDate:t,toDate:c});const v=await pe.get("/api/ezee/syncedRooms",{params:{hotelCode:n,authCode:M,fromDate:t,toDate:c},signal:f});return console.log("← API Response:",v.data),v.data},staleTime:1e3*60*5,gcTime:1e3*60*30}),console.log("Data pre-fetched and cached — navigating to:",`/hotels/${n}`),R(`/hotels/${n}`),x(),S(!1)}catch(t){console.error("Confirm error:",t)}finally{console.log("Confirm flow complete"),i(!1)}},[x,r,s,o,F,u,z,M,U,R,S]);return e.jsxs("div",{className:"calendar-container flex flex-col justify-start md:justify-end relative",children:[e.jsxs("div",{className:"Calender flex flex-col bg-white lg:w-[95%] w-full md:p-6 lg:flex-row gap-6 shadow-lg md:rounded-t-xl overflow-y-auto max-h-[85vh]",children:[h&&e.jsx("div",{ref:b,className:"absolute z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-xl p-5 md:p-6 w-[320px] md:w-[360px] max-w-[90%]",children:e.jsxs("div",{className:"flex flex-col items-center text-start",children:[e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-primary-green/10 rounded-full flex items-center justify-center mb-3",children:e.jsx(se,{name:"calendar",className:"w-6 h-6 md:w-7 md:h-7 text-primary-green"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-primary-dark-green mb-2",children:"Planning a long stay?"}),e.jsx("p",{className:"text-gray-600 text-sm md:text-base mb-4",children:"Currently, we don't support online bookings for more than 30 nights. However, you can tell us about your plans and we'll make it happen."}),e.jsxs("div",{className:"flex justify-between w-full items-center",children:[e.jsx("button",{type:"button",className:"text-primary-yellow w-full font-bold text-left",onClick:()=>window.location.href="/booking-form",children:"Get in touch"}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 w-full text-right text-sm font-medium",onClick:()=>{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate"),w(null),l(null),g(!1)},children:"Continue selection"})]})]})}),h&&e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm z-40",onClick:()=>g(!1)}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-4 md:hidden",children:[e.jsx("button",{onClick:O,className:`flex w-8 h-8 items-center justify-center rounded-full ${T(y,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"text-white bg-primary-green"}`,disabled:T(y,new Date),"aria-label":"Previous month",children:e.jsx(oe,{style:{width:12,height:12}})}),e.jsx("h2",{className:"font-bold text-lg text-primary-green",children:"Select your stay dates"}),e.jsx("button",{onClick:W,className:"flex w-8 h-8 items-center justify-center rounded-full text-white bg-primary-green","aria-label":"Next month",children:e.jsx(le,{style:{width:12,height:12}})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-6",children:[e.jsx(ae,{month:y,allowPrev:!0,allowNext:!1,onPrev:O,onNext:W,daysInWeek:G,checkIn:s,checkOut:o,hoverDate:k,onDayClick:X,onDayHover:Z}),e.jsx(ae,{month:H,allowPrev:!1,allowNext:!0,onPrev:O,onNext:W,daysInWeek:G,checkIn:s,checkOut:o,hoverDate:k,onDayClick:X,onDayHover:Z})]})]})]}),e.jsx("button",{onClick:()=>S(!1),className:"absolute right-4 top-4 text-gray-500 hover:text-gray-700 transition-colors bg-white/80 hover:bg-white rounded-full p-1 shadow-md z-20","aria-label":"Close calendar",children:e.jsx(we,{})}),e.jsxs("div",{className:"footer fixed md:sticky bottom-0 left-0 z-40 bg-white w-full px-4 md:px-8 py-4 md:py-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center w-full md:w-auto md:max-w-[60%] bg-gray-50 px-4 py-3 md:px-6 md:py-4 rounded-xl gap-3 shadow-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{name:"calendar",className:"w-5 h-5 md:w-6 md:h-6 text-primary-green mr-2"}),e.jsxs("div",{className:`flex flex-col ${r&&!s?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check in"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:s?m(s,"EEE, MMM d"):"Select date"})]})]}),e.jsx(je,{className:"text-primary-green mx-1 md:mx-2"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:`flex flex-col ${r&&!o?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check out"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:o?m(o,"EEE, MMM d"):"Select date"})]})}),s&&o&&e.jsx("div",{className:"ml-2 flex items-center justify-center text-xs md:text-sm font-medium text-primary-green bg-primary-green/10 rounded-full px-3 py-1",children:re()})]}),e.jsx("button",{onClick:ce,disabled:!s||!o||h||r,className:`w-full md:w-auto font-bold text-white px-6 py-3 md:py-4 rounded-xl shadow-lg transition ${!s||!o||h||r?"bg-gray-300 cursor-not-allowed":"bg-primary-dark-green hover:bg-primary-green"}`,children:r?"Loading…":"Confirm Dates"})]}),ne.isError&&V&&e.jsx("p",{className:"text-red-600 text-xs mt-2",children:"Could not load availability. Please try again."})]})]})};export{le as A,Me as C};
