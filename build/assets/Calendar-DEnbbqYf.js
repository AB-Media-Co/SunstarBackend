var F=(D,m,x)=>new Promise((v,f)=>{var b=n=>{try{i(x.next(n))}catch(j){f(j)}},I=n=>{try{i(x.throw(n))}catch(j){f(j)}},i=n=>n.done?v(n.value):Promise.resolve(n.value).then(b,I);i((x=x.apply(D,m)).next())});import{p as fe,r as a,j as e,u as he,q as ge,l as ye}from"./react-vendor-CU6lFo1N.js";import{d as B}from"./animation-vendor-DE7fCS50.js";import{I as oe}from"./Icons-LrZeTOCU.js";import{u as pe,c as we}from"./index-DTQi_YP9.js";import{u as be}from"./useRoomsHook-zmtYRA7h.js";import{getSingleHotelWithCode as je}from"./useHotelHook2-4z4wAkLq.js";import{e as Ne,g as ve}from"./urlHelper-C1y1jxtM.js";import{D as Ce,C as U,a as ke,A as W,u as O,l as h,t as Q,q as $,r as R,b as J,e as ne}from"./date-vendor-BpmxrJb6.js";import{aZ as ce,b0 as de,C as Me,aY as Se}from"./ui-vendor-BNgsC25r.js";import"./vendor-DnuN4cIi.js";import"./query-vendor-B8s5OfyV.js";import"./swiper-vendor-CoL_RVtK.js";const ie=fe.memo(function({month:m,allowPrev:x,allowNext:v,onPrev:f,onNext:b,daysInWeek:I,checkIn:i,checkOut:n,hoverDate:j,onDayClick:E,onDayHover:Y}){const g=a.useMemo(()=>Ce(U(m)),[m]),s=42,C=a.useMemo(()=>Array.from({length:s},(l,c)=>ke(g,c)),[g]),r=a.useMemo(()=>W(new Date),[]);return e.jsxs("div",{className:"w-full lg:w-[48%] flex flex-col gap-4 relative p-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[x?e.jsx("button",{onClick:f,className:`hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white shadow-md transition hover:scale-105 ${O(m,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-primary-green"}`,disabled:O(m,new Date),"aria-label":"Previous month",children:e.jsx(ce,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"}),e.jsx("h2",{className:"font-bold text-xl md:text-2xl text-primary-green text-center w-full",children:h(m,"MMMM yyyy")}),v?e.jsx("button",{onClick:b,className:"hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white bg-primary-green shadow-md transition hover:scale-105","aria-label":"Next month",children:e.jsx(de,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"})]}),e.jsxs("div",{className:"px-1 md:px-4",children:[e.jsx("div",{className:"grid grid-cols-7 text-sm md:text-base text-center font-medium text-gray-500 pb-2 border-b border-gray-100",children:I.map((l,c)=>e.jsx("div",{className:"py-2",children:l},c))}),e.jsx("div",{className:"grid grid-cols-7 gap-y-2 sm:gap-y-3 pt-2",children:C.map((l,c)=>{const d=h(l,"M")===h(m,"M"),M=d&&i&&Q(l,i),T=d&&n&&Q(l,n),y=j&&i&&!n&&d&&$(l,i)&&R(l,j),N=d&&i&&n&&$(l,i)&&R(l,n),k=R(l,r),A=Q(l,new Date);return e.jsx("div",{className:`flex items-center justify-center h-10 sm:h-12 relative transition ${d?"":"opacity-0"} ${M?"bg-primary-green rounded-l-full z-10":""} ${T?"bg-primary-green rounded-r-full z-10":""} ${N||y?"bg-primary-green/20":""} ${k?"text-gray-300 cursor-not-allowed":d?"hover:bg-primary-green/10 cursor-pointer":""} ${A&&!M?"ring-2 ring-primary-green/30 ring-inset":""}`,onClick:()=>d&&!k&&E(l),onMouseEnter:()=>d&&!k&&Y(l),children:d&&e.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full text-sm md:text-base font-medium ${M||T?"bg-primary-green text-white scale-110 shadow-md z-20":N||y?"text-primary-green":""}`,children:h(l,"d")})},c)})})]})]})}),Le=({setCheckInDate:D,setCheckOutDate:m,setOpenCalender:x,hotelCode:v})=>{var se,ae,re,le;const[f,b]=a.useState(()=>new Date),I=a.useMemo(()=>J(f,1),[f]),{closeHotelModal:i}=pe(),[n,j]=a.useState(null),E=he();let g=new URLSearchParams(E.search).get("hotelCode");if(!g&&E.pathname.startsWith("/hotels/")){const t=E.pathname.split("/");t.length>2&&(g=Ne(t[2]))}a.useEffect(()=>{localStorage.getItem("hotelInfo")||!g||F(void 0,null,function*(){var u;try{const o=yield je(g);localStorage.setItem("hotelInfo",JSON.stringify(o==null?void 0:o.hotel)),j((u=o==null?void 0:o.hotel)==null?void 0:u.authKey)}catch(o){console.error("❌ Failed to fetch hotel info:",o)}})},[g]);const[s,C]=a.useState(null),[r,l]=a.useState(null),[c,d]=a.useState(!1),[M,T]=a.useState(null),[y,N]=a.useState(!1),k=a.useRef(null),A=ge(),G=ye(),Z=a.useMemo(()=>["S","M","T","W","T","F","S"],[]);a.useMemo(()=>W(new Date),[]);const p=a.useMemo(()=>{try{return JSON.parse(localStorage.getItem("hotelInfo")||"null")}catch(t){return null}},[]);a.useEffect(()=>{const t=localStorage.getItem("checkInDate"),u=localStorage.getItem("checkOutDate"),o=K=>K?W(new Date(K)):null,w=o(t),z=o(u),S=W(new Date);if(!w||!z||R(w,S)||!$(z,w)||!$(z,S)){C(null),l(null);try{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate")}catch(K){}b(U(S));return}C(w),l(z),b(U(w))},[]),a.useEffect(()=>{y&&k.current&&B.fromTo(k.current,{opacity:0,y:-20,scale:.95},{opacity:1,y:0,scale:1,duration:.5,ease:"back.out(1.7)"})},[y]),a.useEffect(()=>{B.fromTo(".Calender",{x:300,opacity:0},{duration:.8,x:0,opacity:1,ease:"power3.out"}),B.fromTo(".footer",{y:50,opacity:0},{duration:.8,y:0,opacity:1,ease:"power3.out",delay:.3})},[]);const H=(ae=(se=v!=null?v:p==null?void 0:p.hotelCode)!=null?se:g)!=null?ae:null,P=(le=(re=p==null?void 0:p.authKey)!=null?re:n)!=null?le:null,_=a.useMemo(()=>s?h(s,"yyyy-MM-dd"):null,[s]),V=a.useMemo(()=>r?h(r,"yyyy-MM-dd"):null,[r]),X=!!(H&&P&&_&&V),me=be(H,P,_,V,{enabled:X,staleTime:1e3*60*5,gcTime:1e3*60*30,refetchOnWindowFocus:!1,keepPreviousData:!0,retry:1}),ee=a.useCallback(t=>{if(!s||s&&r)C(t),l(null),N(!1);else if(R(t,s))C(t),N(!1);else{const u=ne(t,s);l(t),N(u>30)}},[s,r]),te=a.useCallback(t=>{s&&!r&&T(t)},[s,r]),q=a.useCallback(()=>b(t=>J(t,-1)),[]),L=a.useCallback(()=>b(t=>J(t,1)),[]),ue=a.useCallback(()=>{if(s&&r){const t=ne(r,s);return t===1?"1 Night":`${t} Nights`}return""},[s,r]),xe=a.useCallback(()=>F(void 0,null,function*(){if(c){console.log("Confirm already clicked — ignoring duplicate click");return}d(!0);try{if(!s||!r){console.warn("Missing check-in or check-out date");return}if($(s,r)){console.warn("Invalid date range: check-in is after check-out");return}const t=h(s,"yyyy-MM-dd"),u=h(r,"yyyy-MM-dd");D(t),m(u);try{localStorage.setItem("checkInDate",t),localStorage.setItem("checkOutDate",u)}catch(w){console.warn("Failed to save dates to localStorage:",w)}const o=H;if(!o){console.warn("No hotel code found — cannot proceed");return}console.log("Fetching rooms for hotel:",o),yield G.ensureQueryData({queryKey:["rooms",o,P,t,u],queryFn:z=>F(void 0,[z],function*({signal:w}){const S=yield we.get("/api/ezee/syncedRooms",{params:{hotelCode:o,authCode:P,fromDate:t,toDate:u},signal:w});return console.log("← API Response:",S.data),S.data}),staleTime:1e3*60*5,gcTime:1e3*60*30}),A(ve(o,p==null?void 0:p.name)),x(!1),i()}catch(t){console.error("Confirm error:",t)}finally{d(!1)}}),[i,c,s,r,D,m,H,P,G,A,x]);return e.jsxs("div",{className:"calendar-container flex flex-col justify-start md:justify-end relative",children:[e.jsxs("div",{className:"Calender flex flex-col bg-white lg:w-[95%] w-full md:p-6 lg:flex-row gap-6 shadow-lg md:rounded-t-xl overflow-y-auto max-h-[85vh]",children:[y&&e.jsx("div",{ref:k,className:"absolute z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-xl p-5 md:p-6 w-[320px] md:w-[360px] max-w-[90%]",children:e.jsxs("div",{className:"flex flex-col items-center text-start",children:[e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-primary-green/10 rounded-full flex items-center justify-center mb-3",children:e.jsx(oe,{name:"calendar",className:"w-6 h-6 md:w-7 md:h-7 text-primary-green"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-primary-dark-green mb-2",children:"Planning a long stay?"}),e.jsx("p",{className:"text-gray-600 text-sm md:text-base mb-4",children:"Currently, we don't support online bookings for more than 30 nights. However, you can tell us about your plans and we'll make it happen."}),e.jsxs("div",{className:"flex justify-between w-full items-center",children:[e.jsx("button",{type:"button",className:"text-primary-yellow w-full font-bold text-left",onClick:()=>window.location.href="/booking-form",children:"Get in touch"}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 w-full text-right text-sm font-medium",onClick:()=>{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate"),C(null),l(null),N(!1)},children:"Continue selection"})]})]})}),y&&e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm z-40",onClick:()=>N(!1)}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-4 md:hidden",children:[e.jsx("button",{onClick:q,className:`flex w-8 h-8 items-center justify-center rounded-full ${O(f,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"text-white bg-primary-green"}`,disabled:O(f,new Date),"aria-label":"Previous month",children:e.jsx(ce,{style:{width:12,height:12}})}),e.jsx("h2",{className:"font-bold text-lg text-primary-green",children:"Select your stay dates"}),e.jsx("button",{onClick:L,className:"flex w-8 h-8 items-center justify-center rounded-full text-white bg-primary-green","aria-label":"Next month",children:e.jsx(de,{style:{width:12,height:12}})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-6",children:[e.jsx(ie,{month:f,allowPrev:!0,allowNext:!1,onPrev:q,onNext:L,daysInWeek:Z,checkIn:s,checkOut:r,hoverDate:M,onDayClick:ee,onDayHover:te}),e.jsx(ie,{month:I,allowPrev:!1,allowNext:!0,onPrev:q,onNext:L,daysInWeek:Z,checkIn:s,checkOut:r,hoverDate:M,onDayClick:ee,onDayHover:te})]})]})]}),e.jsx("button",{onClick:()=>x(!1),className:"absolute right-4 top-4 text-gray-500 hover:text-gray-700 transition-colors bg-white/80 hover:bg-white rounded-full p-1 shadow-md z-20","aria-label":"Close calendar",children:e.jsx(Me,{})}),e.jsxs("div",{className:"footer fixed md:sticky bottom-0 left-0 z-40 bg-white w-full px-4 md:px-8 py-4 md:py-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center w-full md:w-auto md:max-w-[60%] bg-gray-50 px-4 py-3 md:px-6 md:py-4 rounded-xl gap-3 shadow-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{name:"calendar",className:"w-5 h-5 md:w-6 md:h-6 text-primary-green mr-2"}),e.jsxs("div",{className:`flex flex-col ${c&&!s?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check in"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:s?h(s,"EEE, MMM d"):"Select date"})]})]}),e.jsx(Se,{className:"text-primary-green mx-1 md:mx-2"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:`flex flex-col ${c&&!r?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check out"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:r?h(r,"EEE, MMM d"):"Select date"})]})}),s&&r&&e.jsx("div",{className:"ml-2 flex items-center justify-center text-xs md:text-sm font-medium text-primary-green bg-primary-green/10 rounded-full px-3 py-1",children:ue()})]}),e.jsx("button",{onClick:xe,disabled:!s||!r||y||c,className:`w-full md:w-auto font-bold text-white px-6 py-3 md:py-4 rounded-xl shadow-lg transition ${!s||!r||y||c?"bg-gray-300 cursor-not-allowed":"bg-primary-dark-green hover:bg-primary-green"}`,children:c?"Loading…":"Confirm Dates"})]}),me.isError&&X&&e.jsx("p",{className:"text-red-600 text-xs mt-2",children:"Could not load availability. Please try again."})]})]})};export{Le as default};
