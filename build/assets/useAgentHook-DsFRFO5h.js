var F=Object.defineProperty;var w=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var v=(n,e,t)=>e in n?F(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,r=(n,e)=>{for(var t in e||(e={}))C.call(e,t)&&v(n,t,e[t]);if(w)for(var t of w(e))S.call(e,t)&&v(n,t,e[t]);return n};var o=(n,e,t)=>new Promise((a,i)=>{var u=l=>{try{m(t.next(l))}catch(f){i(f)}},y=l=>{try{m(t.throw(l))}catch(f){i(f)}},m=l=>l.done?a(l.value):Promise.resolve(l.value).then(u,y);m((t=t.apply(n,e)).next())});import{g as q,x as d,y as g,f as c,h as s}from"./index-BuGOVJXi.js";const Q=(n={})=>q({queryKey:["agents",n],queryFn:()=>o(void 0,null,function*(){var t;const e=yield c.get("/api/agents",{params:n});return((t=e==null?void 0:e.data)==null?void 0:t.data)||[]}),staleTime:3e4,refetchOnWindowFocus:!1}),K=()=>g({mutationFn:n=>o(void 0,null,function*(){const e=yield c.post("/api/agents/login",n);return r({httpStatus:e.status},e.data)}),onSuccess:n=>{s.success((n==null?void 0:n.message)||"OTP sent to your email")},onError:n=>{var e,t;s.error(((t=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:t.message)||"Login failed")}}),p=()=>{const n=d();return g({mutationFn:e=>o(void 0,null,function*(){const t=yield c.post("/api/agents/verify-otp",e);return r({httpStatus:t.status},t.data)}),onSuccess:(e,t)=>{var i,u;const a=String(((i=e==null?void 0:e.data)==null?void 0:i.email)||(t==null?void 0:t.email)||"").toLowerCase();a&&localStorage.setItem("user_email",a),e!=null&&e.data&&n.setQueryData(["agent-by-email",a],e.data),n.invalidateQueries({queryKey:["agent-by-email",a]}),n.invalidateQueries({queryKey:["agents"]}),(e==null?void 0:e.pendingApproval)===!0||((u=e==null?void 0:e.data)==null?void 0:u.approved)===!1?s.success((e==null?void 0:e.message)||"Verified. Your account is pending approval."):e!=null&&e.ok?s.success((e==null?void 0:e.message)||"Login successful"):s.error((e==null?void 0:e.message)||"Verification failed")},onError:e=>{var i,u,y;const t=(i=e==null?void 0:e.response)==null?void 0:i.status,a=(y=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:y.message;if(t===403){s.success(a||"Verified. Your account is pending approval.");return}s.error(a||"Invalid or expired OTP")}})},b=()=>g({mutationFn:n=>o(void 0,null,function*(){return(yield c.post("/api/agents/login",n)).data}),onSuccess:n=>{s.success((n==null?void 0:n.message)||"OTP re-sent")},onError:n=>{var e,t;s.error(((t=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to resend OTP")}}),h=()=>{const n=d();return g({mutationFn:e=>o(void 0,null,function*(){var a;const t=yield c.post(`/api/agents/${e}/approve`);return(a=t==null?void 0:t.data)==null?void 0:a.data}),onSuccess:e=>{s.success("Agent approved"),n.invalidateQueries({queryKey:["agents"]}),e!=null&&e._id&&n.setQueryData(["agent",e._id],e),e!=null&&e.email&&n.invalidateQueries({queryKey:["agent-by-email",String(e.email).toLowerCase()]})},onError:e=>{var t,a;s.error(((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)||"Approval failed")}})},O=n=>{const e=String(n||"").toLowerCase();return q({queryKey:["agent-by-email",e],enabled:!!e,queryFn:()=>o(void 0,null,function*(){var a;const t=yield c.get("/api/agents/by-email",{params:{email:e}});return((a=t==null?void 0:t.data)==null?void 0:a.data)||null}),staleTime:3e4,refetchOnWindowFocus:!1,refetchInterval:t=>t&&t.isVerified&&!t.approved?15e3:!1})},_=()=>{const n=d();return g({mutationFn:e=>o(void 0,null,function*(){return(yield c.delete(`/api/agents/${e}`)).data}),onSuccess:e=>{s.success((e==null?void 0:e.message)||"Agent deleted"),n.invalidateQueries({queryKey:["agents"]})},onError:e=>{var t,a;s.error(((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)||"Delete failed")}})},L=()=>{const n=d();return g({mutationFn:a=>o(void 0,[a],function*({id:e,commissionRate:t}){var u;const i=yield c.patch(`/api/agents/${e}/commission`,{commissionRate:t});return(u=i==null?void 0:i.data)==null?void 0:u.data}),onSuccess:e=>{s.success("Commission updated successfully"),n.invalidateQueries({queryKey:["agents"]}),e!=null&&e._id&&n.setQueryData(["agent",e._id],e),e!=null&&e.email&&n.invalidateQueries({queryKey:["agent-by-email",String(e.email).toLowerCase()]})},onError:e=>{var t,a;s.error(((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update commission")}})},T=n=>(console.log(" useCalculateEarnings called with email:",n),q({queryKey:["calculate-earnings",n],queryFn:()=>o(void 0,null,function*(){if(!n)return console.log(" No email provided"),null;console.log(" API Call: /api/agents/calculate-earnings/"+n);const e=yield c.get(`/api/agents/calculate-earnings/${n}`);return console.log(" Response:",e==null?void 0:e.data),e==null?void 0:e.data}),enabled:!!n,staleTime:5*60*1e3})),D=()=>g({mutationFn:t=>o(void 0,[t],function*({email:n,totalEarnings:e}){const a=yield c.post(`/api/agents/update-earnings/${n}`,{totalEarnings:e});return a==null?void 0:a.data}),onSuccess:n=>{console.log(" Earnings updated:",n)},onError:n=>{console.error(" Failed to update earnings:",n)}});export{h as a,_ as b,L as c,K as d,p as e,b as f,O as g,T as h,D as i,Q as u};
