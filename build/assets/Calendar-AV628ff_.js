var e=(e,t,a)=>new Promise(((l,s)=>{var r=e=>{try{o(a.next(e))}catch(t){s(t)}},n=e=>{try{o(a.throw(e))}catch(t){s(t)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,n);o((a=a.apply(e,t)).next())}));import{p as t,r as a,j as l,u as s,q as r,l as n}from"./react-vendor-tq68JOgp.js";import{d as o}from"./animation-vendor-DJegggv9.js";import{I as i}from"./Icons-DdOEP3uY.js";import{u as c,c as d}from"./index-D89k_Hd_.js";import{u as m}from"./useRoomsHook-BKU-rVeT.js";import{getSingleHotelWithCode as u}from"./useHotelHook2-C33856rg.js";import{e as x,g as h}from"./urlHelper-B-upFRYv.js";import{D as y,C as f,a as g,A as p,u as w,l as b,t as j,q as v,r as N,b as k,e as C}from"./date-vendor-9E3U4XI3.js";import{aZ as D,b0 as M,C as I,aY as S}from"./ui-vendor-DiJ4VKpG.js";import"./vendor-DwD9zxym.js";import"./query-vendor-iDpT9gG9.js";import"./swiper-vendor-DEzR9mKq.js";const P=t.memo((function({month:e,allowPrev:t,allowNext:s,onPrev:r,onNext:n,daysInWeek:o,checkIn:i,checkOut:c,hoverDate:d,onDayClick:m,onDayHover:u}){const x=a.useMemo((()=>y(f(e))),[e]),h=a.useMemo((()=>Array.from({length:42},((e,t)=>g(x,t)))),[x]),k=a.useMemo((()=>p(new Date)),[]);return l.jsxs("div",{className:"w-full lg:w-[48%] flex flex-col gap-4 relative p-4",children:[l.jsxs("div",{className:"flex items-center justify-between px-2",children:[t?l.jsx("button",{onClick:r,className:"hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white shadow-md transition hover:scale-105 "+(w(e,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-primary-green"),disabled:w(e,new Date),"aria-label":"Previous month",children:l.jsx(D,{style:{width:16,height:16}})}):l.jsx("span",{className:"w-10"}),l.jsx("h2",{className:"font-bold text-xl md:text-2xl text-primary-green text-center w-full",children:b(e,"MMMM yyyy")}),s?l.jsx("button",{onClick:n,className:"hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white bg-primary-green shadow-md transition hover:scale-105","aria-label":"Next month",children:l.jsx(M,{style:{width:16,height:16}})}):l.jsx("span",{className:"w-10"})]}),l.jsxs("div",{className:"px-1 md:px-4",children:[l.jsx("div",{className:"grid grid-cols-7 text-sm md:text-base text-center font-medium text-gray-500 pb-2 border-b border-gray-100",children:o.map(((e,t)=>l.jsx("div",{className:"py-2",children:e},t)))}),l.jsx("div",{className:"grid grid-cols-7 gap-y-2 sm:gap-y-3 pt-2",children:h.map(((t,a)=>{const s=b(t,"M")===b(e,"M"),r=s&&i&&j(t,i),n=s&&c&&j(t,c),o=d&&i&&!c&&s&&v(t,i)&&N(t,d),x=s&&i&&c&&v(t,i)&&N(t,c),h=N(t,k),y=j(t,new Date);return l.jsx("div",{className:`flex items-center justify-center h-10 sm:h-12 relative transition ${s?"":"opacity-0"} ${r?"bg-primary-green rounded-l-full z-10":""} ${n?"bg-primary-green rounded-r-full z-10":""} ${x||o?"bg-primary-green/20":""} ${h?"text-gray-300 cursor-not-allowed":s?"hover:bg-primary-green/10 cursor-pointer":""} ${y&&!r?"ring-2 ring-primary-green/30 ring-inset":""}`,onClick:()=>s&&!h&&m(t),onMouseEnter:()=>s&&!h&&u(t),children:s&&l.jsx("div",{className:"flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full text-sm md:text-base font-medium "+(r||n?"bg-primary-green text-white scale-110 shadow-md z-20":x||o?"text-primary-green":""),children:b(t,"d")})},a)}))})]})]})})),E=({setCheckInDate:t,setCheckOutDate:y,setOpenCalender:g,hotelCode:j})=>{var E,O,H,T;const[z,$]=a.useState((()=>new Date)),W=a.useMemo((()=>k(z,1)),[z]),{closeHotelModal:q}=c(),[R,F]=a.useState(null),J=s();let K=new URLSearchParams(J.search).get("hotelCode");if(!K&&J.pathname.startsWith("/hotels/")){const e=J.pathname.split("/");e.length>2&&(K=x(e[2]))}a.useEffect((()=>{!localStorage.getItem("hotelInfo")&&K&&e(void 0,null,(function*(){var e;try{const t=yield u(K);localStorage.setItem("hotelInfo",JSON.stringify(null==t?void 0:t.hotel)),F(null==(e=null==t?void 0:t.hotel)?void 0:e.authKey)}catch(t){}}))}),[K]);const[A,L]=a.useState(null),[B,G]=a.useState(null),[Q,U]=a.useState(!1),[Y,Z]=a.useState(null),[V,X]=a.useState(!1),_=a.useRef(null),ee=r(),te=n(),ae=a.useMemo((()=>["S","M","T","W","T","F","S"]),[]);a.useMemo((()=>p(new Date)),[]);const le=a.useMemo((()=>{try{return JSON.parse(localStorage.getItem("hotelInfo")||"null")}catch(e){return null}}),[]);a.useEffect((()=>{const e=localStorage.getItem("checkInDate"),t=localStorage.getItem("checkOutDate"),a=e=>e?p(new Date(e)):null,l=a(e),s=a(t),r=p(new Date);if(l&&s&&!N(l,r)&&v(s,l)&&v(s,r))L(l),G(s),$(f(l));else{L(null),G(null);try{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate")}catch(n){}$(f(r))}}),[]),a.useEffect((()=>{V&&_.current&&o.fromTo(_.current,{opacity:0,y:-20,scale:.95},{opacity:1,y:0,scale:1,duration:.5,ease:"back.out(1.7)"})}),[V]),a.useEffect((()=>{o.fromTo(".Calender",{x:300,opacity:0},{duration:.8,x:0,opacity:1,ease:"power3.out"}),o.fromTo(".footer",{y:50,opacity:0},{duration:.8,y:0,opacity:1,ease:"power3.out",delay:.3})}),[]);const se=null!=(O=null!=(E=null!=j?j:null==le?void 0:le.hotelCode)?E:K)?O:null,re=null!=(T=null!=(H=null==le?void 0:le.authKey)?H:R)?T:null,ne=a.useMemo((()=>A?b(A,"yyyy-MM-dd"):null),[A]),oe=a.useMemo((()=>B?b(B,"yyyy-MM-dd"):null),[B]),ie=Boolean(se&&re&&ne&&oe),ce=m(se,re,ne,oe,{enabled:ie,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,keepPreviousData:!0,retry:1}),de=a.useCallback((e=>{if(!A||A&&B)L(e),G(null),X(!1);else if(N(e,A))L(e),X(!1);else{const t=C(e,A);G(e),X(t>30)}}),[A,B]),me=a.useCallback((e=>{A&&!B&&Z(e)}),[A,B]),ue=a.useCallback((()=>$((e=>k(e,-1)))),[]),xe=a.useCallback((()=>$((e=>k(e,1)))),[]),he=a.useCallback((()=>{if(A&&B){const e=C(B,A);return 1===e?"1 Night":`${e} Nights`}return""}),[A,B]),ye=a.useCallback((()=>e(void 0,null,(function*(){if(!Q){U(!0);try{if(!A||!B)return;if(v(A,B))return;const l=b(A,"yyyy-MM-dd"),s=b(B,"yyyy-MM-dd");t(l),y(s);try{localStorage.setItem("checkInDate",l),localStorage.setItem("checkOutDate",s)}catch(a){}const r=se;if(!r)return;yield te.ensureQueryData({queryKey:["rooms",r,re,l,s],queryFn:t=>e(void 0,[t],(function*({signal:e}){return(yield d.get("/api/ezee/syncedRooms",{params:{hotelCode:r,authCode:re,fromDate:l,toDate:s},signal:e})).data})),staleTime:3e5,gcTime:18e5}),ee(h(r,null==le?void 0:le.name)),g(!1),q()}catch(l){}finally{U(!1)}}}))),[q,Q,A,B,t,y,se,re,te,ee,g]);return l.jsxs("div",{className:"calendar-container flex flex-col justify-start md:justify-end relative",children:[l.jsxs("div",{className:"Calender flex flex-col bg-white lg:w-[95%] w-full md:p-6 lg:flex-row gap-6 shadow-lg md:rounded-t-xl overflow-y-auto max-h-[85vh]",children:[V&&l.jsx("div",{ref:_,className:"absolute z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-xl p-5 md:p-6 w-[320px] md:w-[360px] max-w-[90%]",children:l.jsxs("div",{className:"flex flex-col items-center text-start",children:[l.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-primary-green/10 rounded-full flex items-center justify-center mb-3",children:l.jsx(i,{name:"calendar",className:"w-6 h-6 md:w-7 md:h-7 text-primary-green"})}),l.jsx("h3",{className:"text-lg md:text-xl font-bold text-primary-dark-green mb-2",children:"Planning a long stay?"}),l.jsx("p",{className:"text-gray-600 text-sm md:text-base mb-4",children:"Currently, we don't support online bookings for more than 30 nights. However, you can tell us about your plans and we'll make it happen."}),l.jsxs("div",{className:"flex justify-between w-full items-center",children:[l.jsx("button",{type:"button",className:"text-primary-yellow w-full font-bold text-left",onClick:()=>window.location.href="/booking-form",children:"Get in touch"}),l.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 w-full text-right text-sm font-medium",onClick:()=>{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate"),L(null),G(null),X(!1)},children:"Continue selection"})]})]})}),V&&l.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm z-40",onClick:()=>X(!1)}),l.jsxs("div",{className:"flex flex-col w-full gap-4",children:[l.jsxs("div",{className:"flex items-center justify-between px-4 pt-4 md:hidden",children:[l.jsx("button",{onClick:ue,className:"flex w-8 h-8 items-center justify-center rounded-full "+(w(z,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"text-white bg-primary-green"),disabled:w(z,new Date),"aria-label":"Previous month",children:l.jsx(D,{style:{width:12,height:12}})}),l.jsx("h2",{className:"font-bold text-lg text-primary-green",children:"Select your stay dates"}),l.jsx("button",{onClick:xe,className:"flex w-8 h-8 items-center justify-center rounded-full text-white bg-primary-green","aria-label":"Next month",children:l.jsx(M,{style:{width:12,height:12}})})]}),l.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-6",children:[l.jsx(P,{month:z,allowPrev:!0,allowNext:!1,onPrev:ue,onNext:xe,daysInWeek:ae,checkIn:A,checkOut:B,hoverDate:Y,onDayClick:de,onDayHover:me}),l.jsx(P,{month:W,allowPrev:!1,allowNext:!0,onPrev:ue,onNext:xe,daysInWeek:ae,checkIn:A,checkOut:B,hoverDate:Y,onDayClick:de,onDayHover:me})]})]})]}),l.jsx("button",{onClick:()=>g(!1),className:"absolute right-4 top-4 text-gray-500 hover:text-gray-700 transition-colors bg-white/80 hover:bg-white rounded-full p-1 shadow-md z-20","aria-label":"Close calendar",children:l.jsx(I,{})}),l.jsxs("div",{className:"footer fixed md:sticky bottom-0 left-0 z-40 bg-white w-full px-4 md:px-8 py-4 md:py-6 shadow-lg",children:[l.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-center",children:[l.jsxs("div",{className:"flex items-center w-full md:w-auto md:max-w-[60%] bg-gray-50 px-4 py-3 md:px-6 md:py-4 rounded-xl gap-3 shadow-md",children:[l.jsxs("div",{className:"flex items-center",children:[l.jsx(i,{name:"calendar",className:"w-5 h-5 md:w-6 md:h-6 text-primary-green mr-2"}),l.jsxs("div",{className:"flex flex-col "+(Q&&!A?"text-red-500":"text-gray-700"),children:[l.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check in"}),l.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:A?b(A,"EEE, MMM d"):"Select date"})]})]}),l.jsx(S,{className:"text-primary-green mx-1 md:mx-2"}),l.jsx("div",{className:"flex items-center",children:l.jsxs("div",{className:"flex flex-col "+(Q&&!B?"text-red-500":"text-gray-700"),children:[l.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check out"}),l.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:B?b(B,"EEE, MMM d"):"Select date"})]})}),A&&B&&l.jsx("div",{className:"ml-2 flex items-center justify-center text-xs md:text-sm font-medium text-primary-green bg-primary-green/10 rounded-full px-3 py-1",children:he()})]}),l.jsx("button",{onClick:ye,disabled:!A||!B||V||Q,className:"w-full md:w-auto font-bold text-white px-6 py-3 md:py-4 rounded-xl shadow-lg transition "+(!A||!B||V||Q?"bg-gray-300 cursor-not-allowed":"bg-primary-dark-green hover:bg-primary-green"),children:Q?"Loadingâ€¦":"Confirm Dates"})]}),ce.isError&&ie&&l.jsx("p",{className:"text-red-600 text-xs mt-2",children:"Could not load availability. Please try again."})]})]})};export{E as default};
